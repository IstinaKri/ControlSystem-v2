{% extends 'main/director_base.html' %}
{% load static %}

{% block title %}Управление посетителями{% endblock %}

{% block page_title %}Управление посетителями{% endblock %}


{% block extra_css %}
<style>
.dashboard-container {
    padding: 20px;
    background: #f3f4f6;
    min-height: calc(100vh - 60px);
}
.requests-section {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 20px;
}
.visitors-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.add-visitor-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}

.add-visitor-btn:hover {
    background-color: #45a049;
}


.action-btn {
    padding: 6px 12px;
    border: 1px solid #222;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    background: #fff;
    color: #222;
    margin-bottom: 4px;
    margin-right: 4px;
    transition: all 0.2s;
}

.action-btn:hover {
    background: #f3f4f6;
    color: #111;
    border-color: #111;
}

/* Убираем специфические цвета */
.view-btn, .edit-btn {
    background: #fff !important;
    color: #222 !important;
    border: 1px solid #222 !important;
}

.visitors-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.visitors-table th,
.visitors-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.visitors-table th {
    background-color: #f5f5f5;
    font-weight: 600;
}

.visitors-table tr:hover {
    background-color: #f9f9f9;
}

/* Модальные окна */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
}

.modal-content {
    position: relative;
    background-color: white;
    margin: 50px auto;
    padding: 20px;
    width: 80%;
    max-width: 800px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.modal-header h2 {
    margin: 0;
    color: #333;
}
.car-section {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Полупрозрачный фон */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000; /* Убедитесь, что блок будет выше других элементов */
}

.car-section-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    width: 300px; /* Размер блока */
    max-width: 90%; /* Максимальная ширина */
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.close-modal:hover {
    color: #333;
}

/* Стили для формы редактирования */
.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    color: #555;
}

.form-group input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.cancel-btn {
    padding: 8px 16px;
    background-color: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
}

.save-btn {
    padding: 8px 16px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.save-btn:hover {
    background-color: #45a049;
}

/* Стили для информации о поездках */
.visitor-trips {
    margin-top: 20px;
}

.visitor-info {
    margin-bottom: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 4px;
}

.visitor-info h3 {
    margin: 0 0 5px 0;
    color: #333;
}

.visitor-info p {
    margin: 0;
    color: #666;
}

.trips-list {
    margin-top: 20px;
}

.trips-list h4 {
    margin: 0 0 10px 0;
    color: #333;
}

.trips-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

.trips-table th,
.trips-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.trips-table th {
    background-color: #f5f5f5;
    font-weight: 600;
}

.trips-table tr:hover {
    background-color: #f9f9f9;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px 24px;
}

@media (max-width: 700px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
}

.form-actions-center {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="requests-section">
    <div class="visitors-header">
        <h2>Список посетителей</h2>
        <button class="add-visitor-btn" onclick="openAddVisitorModal()">Добавить посетителя</button>
    </div>

    <table class="visitors-table">
        <thead>
            <tr>
                <th>ФИО</th>
                <th>Должность</th>
                <th>Организация</th>
                <th>Телефон</th>
                <th>Email</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for visitor in visitors %}
            <tr>
                <td>{{ visitor.get_full_name }}</td>
                <td>{{ visitor.position }}</td>
                <td>{{ visitor.organization }}</td>
                <td>{{ visitor.phone }}</td>
                <td>{{ visitor.email }}</td>
                <td>
                    <button class="action-btn edit-btn" onclick="openEditVisitorModal({{ visitor.id }})">
                        <i class="fas fa-edit"></i> Изменить
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


<!-- Модальное окно добавления посетителя -->
<div id="addVisitorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Добавить посетителя</h2>
            <button class="close-modal" onclick="closeAddVisitorModal()">&times;</button>
        </div>

        <form id="addVisitorForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="addFirstName">Имя</label>
                    <input type="text" id="addFirstName" name="firstName" required>
                </div>
                <div class="form-group">
                    <label for="addLastName">Фамилия</label>
                    <input type="text" id="addLastName" name="lastName" required>
                </div>
                <div class="form-group">
                    <label for="addEmail">Email</label>
                    <input type="email" id="addEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="addPhone">Телефон</label>
                    <input type="tel" id="addPhone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="addPosition">Должность</label>
                    <input type="text" id="addPosition" name="position" required>
                </div>
                <div class="form-group">
                    <label for="addOrganization">Организация</label>
                    <input type="text" id="addOrganization" name="organization" required>
                </div>
                <div class="form-group">
                    <label for="addPhoto">Фото посетителя</label>
                    <input type="file" id="addPhoto" name="photo" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="addDocs">Документы (PDF, JPG, PNG)</label>
                    <input type="file" id="addDocs" name="documents" accept=".pdf,.jpg,.jpeg,.png" multiple>
                </div>
            </div>
            <div class="form-group form-actions form-actions-center">
                <button type="button" class="save-btn" onclick="openAddCarModal()">Добавить авто</button>
            </div>
        </form>
    </div>
</div>

<!-- Модальное окно изменения посетителя -->
<div id="editVisitorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Изменить посетителя</h2>
            <button class="close-modal" onclick="closeEditVisitorModal()">&times;</button>
        </div>

        <form id="editVisitorForm">
            <div class="form-group">
                <label for="editFirstName">Имя</label>
                <input type="text" id="editFirstName" name="firstName" required>
            </div>
            <div class="form-group">
                <label for="editLastName">Фамилия</label>
                <input type="text" id="editLastName" name="lastName" required>
            </div>
            <div class="form-group">
                <label for="editEmail">Email</label>
                <input type="email" id="editEmail" name="email" required>
            </div>
            <div class="form-group">
                <label for="editPhone">Телефон</label>
                <input type="tel" id="editPhone" name="phone" required>
            </div>
            <div class="form-group">
                <label for="editPosition">Должность</label>
                <input type="text" id="editPosition" name="position" required>
            </div>
            <div class="form-group">
                <label for="editOrganization">Организация</label>
                <input type="text" id="editOrganization" name="organization" required>
            </div>
            <div class="form-group">
                <label for="editPhoto">Фото посетителя</label>
                <input type="file" id="editPhoto" name="photo" accept="image/*">
            </div>
            <div class="form-group">
                <label for="editDocs">Документы (PDF, JPG, PNG)</label>
                <input type="file" id="editDocs" name="documents" accept=".pdf,.jpg,.jpeg,.png" multiple>
            </div>
            <div class="form-group">
                <button type="submit" class="save-btn">Сохранить изменения</button>
            </div>
        </form>
    </div>
</div>

<!-- Модальное окно добавления автомобиля -->
<div id="addCarModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Информация об автомобиле</h2>
            <button class="close-modal" onclick="closeAddCarModal()">&times;</button>
        </div>
        <form id="addCarForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="carBrand">Бренд</label>
                    <input type="text" id="carBrand" name="carBrand" required>
                </div>
                <div class="form-group">
                    <label for="carColor">Цвет</label>
                    <input type="text" id="carColor" name="carColor" required>
                </div>
                <div class="form-group">
                    <label for="carNumber">Номер</label>
                    <input type="text" id="carNumber" name="carNumber" required>
                </div>
                <div class="form-group">
                    <label for="carRegion">Регион</label>
                    <input type="text" id="carRegion" name="carRegion" required>
                </div>
                <div class="form-group">
                    <label for="carCountry">Страна</label>
                    <input type="text" id="carCountry" name="carCountry" required>
                </div>
                <div class="form-group">
                    <label for="carDocs">Документы на авто (PDF, JPG, PNG)</label>
                    <input type="file" id="carDocs" name="carDocs" accept=".pdf,.jpg,.jpeg,.png" multiple>
                </div>
            </div>
            <div class="form-group form-actions form-actions-center">
                <button type="submit" class="save-btn">Сохранить автомобиль</button>
            </div>
        </form>
    </div>
</div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Открытие модального окна добавления
    function openAddVisitorModal() {
        document.getElementById('addVisitorModal').style.display = 'block';
    }

    // Закрытие модального окна добавления
    function closeAddVisitorModal() {
        document.getElementById('addVisitorModal').style.display = 'none';
    }

    // Открытие модального окна редактирования посетителя
    function openEditVisitorModal(visitorId) {
        // Получить информацию о посетителе через API или из данных страницы
        // Здесь используем фиктивные данные для примера
        let visitor = getVisitorData(visitorId);
        
        // Заполняем форму редактирования данными посетителя
        document.getElementById('editFirstName').value = visitor.firstName;
        document.getElementById('editLastName').value = visitor.lastName;
        document.getElementById('editEmail').value = visitor.email;
        document.getElementById('editPhone').value = visitor.phone;
        document.getElementById('editPosition').value = visitor.position;
        document.getElementById('editOrganization').value = visitor.organization;

        // Открываем модальное окно редактирования
        document.getElementById('editVisitorModal').style.display = 'block';
    }

    // Закрытие модального окна редактирования
    function closeEditVisitorModal() {
        document.getElementById('editVisitorModal').style.display = 'none';
    }

    // Закрытие модального окна по клику вне контента
    window.onclick = function(event) {
        const addModal = document.getElementById('addVisitorModal');
        const editModal = document.getElementById('editVisitorModal');

        if (event.target === addModal) {
            addModal.style.display = "none";
        }
        if (event.target === editModal) {
            editModal.style.display = "none";
        }
    }

    // Пример получения данных о посетителе
    function getVisitorData(visitorId) {
        // Здесь вы можете использовать AJAX или fetch для получения данных из базы данных
        // Для примера используем фиктивные данные
        return {
            firstName: 'Иван',
            lastName: 'Иванов',
            email: 'ivanov@example.com',
            phone: '+7 123 456 7890',
            position: 'Менеджер',
            organization: 'Компания XYZ'
        };
    }

    // Пример обработчика на отправку формы (если нужно)
    document.getElementById('editVisitorForm').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Данные посетителя обновлены!');
        closeEditVisitorModal();
    });

    // Открытие модального окна автомобиля
    function openAddCarModal() {
        document.getElementById('addVisitorModal').style.display = 'none';
        document.getElementById('addCarModal').style.display = 'block';
    }

    // Закрытие модального окна автомобиля
    function closeAddCarModal() {
        document.getElementById('addCarModal').style.display = 'none';
    }

    document.getElementById('addCarForm').addEventListener('submit', function(e) {
        e.preventDefault();
        // Здесь обработка данных автомобиля
        alert('Автомобиль добавлен!');
        closeAddCarModal();
    });
</script>
{% endblock %}
